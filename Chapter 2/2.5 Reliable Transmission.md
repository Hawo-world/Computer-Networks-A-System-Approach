# 🧭 2.5 Reliable Transmission

Even with strong error detection (like CRC), some frames are still lost or corrupted beyond correction.  
To achieve reliable delivery, link-level protocols (or higher layers) use acknowledgments and timeouts to detect lost frames and ensure successful delivery.

Reliability can be implemented at multiple layers:
- **Link layer:** between directly connected nodes (sometimes omitted in modern links)  
- **Transport layer:** end-to-end (e.g., TCP)  
- **Application layer:** for special cases like file transfer reliability  

---

## 🔑 Key Concepts

### 1. Goal
To recover lost or corrupted frames so that data arrives correctly and in order.  
Reliability mechanisms ensure that no data is permanently lost, duplicated, or delivered incorrectly.

---

### 2. Mechanisms of Reliability

| Mechanism | Purpose |
|------------|----------|
| **Acknowledgment (ACK)** | Confirms that a frame was received correctly. |
| **Timeout** | Triggers retransmission if an ACK isn’t received in time. |

The combination of ACKs and timeouts is called **Automatic Repeat reQuest (ARQ)** — the foundation of reliable transmission.

---

## ⚙️ 2.5.1 Stop-and-Wait ARQ

### How It Works
Sender transmits one frame and waits for an ACK before sending the next.  
If the ACK doesn’t arrive before the timer expires → retransmit the same frame.

**Common Scenarios**
- (a) ACK received successfully  
- (b) Frame lost  
- (c) ACK lost  
- (d) Timeout fired too soon  

In (c) and (d), the sender retransmits a frame the receiver already got — creating a duplicate.  
To prevent this, the header includes a **1-bit sequence number (0 or 1)** so the receiver can identify duplicates.

---

### Efficiency Limitation
Stop-and-wait allows only one outstanding frame at a time — underutilizing the link.

**Example:**
- Link = 1.5 Mbps  
- RTT = 45 ms  
- Frame size = 1 KB (8 Kb)  

Throughput = 8 Kb / 0.045 s = **182 kbps ≈ 12% utilization**

Thus, it’s inefficient for high-delay or high-bandwidth links — we need a way to “keep the pipe full.”

**Key Takeaway:**  
**Delay × Bandwidth Product** = amount of data that can be “in flight.”  
Reliable protocols should keep this much data in transit to use the link efficiently.

---

## ⚙️ 2.5.2 Sliding Window ARQ

### Goal
Allow multiple outstanding frames before waiting for ACKs → keeps the pipe full.

---

### How It Works
Both sender and receiver maintain “windows” of acceptable sequence numbers.

#### Sender Variables

| Variable | Meaning |
|-----------|----------|
| **SWS** | Send Window Size: Max number of unacknowledged frames allowed. |
| **LAR** | Last Acknowledgment Received. |
| **LFS** | Last Frame Sent. |

**Invariant:** LFS - LAR ≤ SWS  

#### Receiver Variables

| Variable | Meaning |
|-----------|----------|
| **RWS** | Receive Window Size: Max number of out-of-order frames receiver can buffer. |
| **LFR** | Last Frame Received. |
| **LAF** | Largest Acceptable Frame (LFR + RWS). |

**Invariant:** LAF - LFR ≤ RWS  

---

### Receiver Logic
- If frame’s SeqNum ≤ LFR or > LAF → discard.  
- If LFR < SeqNum ≤ LAF → accept and possibly buffer.  
- Receiver sends cumulative ACK up to the highest in-order frame received.  

**Example:**  
LFR = 5, RWS = 4 → window = 6–9  
Frames 7 and 8 arrive early (out of order) → buffered, not ACKed.  
Once frame 6 arrives → ACK 8, shift window to 9–12.

---

### Variations

| Type | Description |
|------|--------------|
| **NAK (Negative ACK)** | Optional; tells sender a specific frame is missing. |
| **Duplicate ACKs** | Can hint at loss earlier than a timeout. |
| **Selective ACKs (SACK)** | Receiver ACKs exactly which frames arrived; helps sender retransmit only missing ones. |

---

### Window Size and Sequence Numbers
Sequence numbers are finite, so they wrap around.  
If only 3 bits (0–7), the number space is small — we must avoid confusion between “old” and “new” frames.

**Rule for Safe Operation**  
If RWS = SWS, then:  
**SWS < (MaxSeqNum + 1) / 2**

This ensures new transmissions can’t be mistaken for old, unacknowledged ones.

---

### Implementation Overview

**Sender**
- Waits until send window has space (semWait).  
- Assigns sequence number, stores frame in sendQ, starts timer, sends frame.  
- If ACK received → cancel timer, free slot, and signal window space (semSignal).

**Receiver**
- Checks if frame sequence is within window (swpInWindow).  
- Buffers valid frames, delivers in order.  
- Sends cumulative ACK for the last in-order frame.

---

### Roles of Sliding Window

| Role | Description |
|------|--------------|
| **Reliable Delivery** | Retransmits lost frames until acknowledged. |
| **Ordered Delivery** | Ensures frames are delivered in sequence. |
| **Flow Control** | Receiver tells sender how many frames it can handle. |

However, these roles can be separated depending on layer design — this is called **Separation of Concerns**.

---

### Design Principle: Separation of Concerns
Each function (reliability, ordering, flow control) should only be implemented where needed — not always at the link layer.

---

## ⚙️ 2.5.3 Concurrent Logical Channels (ARPANET Approach)

### Idea
Instead of using one sliding window, use multiple independent stop-and-wait channels over a single physical link.  
Each channel runs stop-and-wait independently.  
Sender uses the lowest idle channel when transmitting.  
No ordering or flow control — just parallel stop-and-wait.

---

### Practical Details
Each channel keeps:
- A **busy flag**
- A **1-bit sequence number (for sending)**
- A **1-bit expected number (for receiving)**

**ARPANET used:**
- 8 logical channels for ground links  
- 16 channels for satellite links  

Header fields:  
3-bit channel number + 1-bit sequence number = **4 bits total**  
→ Equivalent efficiency to a sliding window with 8 frames outstanding.

**Benefit:**  
Simpler than sliding window.  
Maintains full link utilization.  
Used historically in early networking (e.g., ARPANET).

---

## 🧠 Key Takeaways

- Reliable delivery = **ACK + Timeout** → ensures every frame arrives once.  
- Stop-and-Wait is simple but inefficient for high-latency links.  
- Sliding Window keeps multiple frames “in flight” to maximize throughput.  
- Sequence numbers prevent duplicates and track order.  
- Concurrent logical channels provide an alternate, parallelized method.  
- Apply **Separation of Concerns:** only include reliability, ordering, or flow control where necessary.

---

## 🧾 Glossary

| Term | Definition |
|------|-------------|
| **ACK (Acknowledgment)** | Message confirming successful receipt of a frame. |
| **Timeout** | Trigger to retransmit when no ACK is received in time. |
| **ARQ (Automatic Repeat reQuest)** | Family of protocols using ACKs and timeouts for reliability. |
| **Stop-and-Wait** | Simple ARQ where sender transmits one frame at a time. |
| **Sequence Number** | Field used to distinguish between frames and detect duplicates. |
| **Delay × Bandwidth Product** | The total amount of data that can be “in flight” on a link. |
| **Sliding Window** | ARQ algorithm allowing multiple outstanding unacknowledged frames. |
| **SWS (Send Window Size)** | Max number of frames the sender can transmit without ACKs. |
| **RWS (Receive Window Size)** | Max number of out-of-order frames the receiver can buffer. |
| **Cumulative ACK** | ACK that confirms all frames up to a certain sequence number have arrived. |
| **NAK (Negative ACK)** | Message requesting retransmission of a specific missing frame. |
| **Selective ACK (SACK)** | ACK that specifies exactly which frames were received. |
| **Flow Control** | Mechanism to prevent sender from overwhelming receiver. |
| **Separation of Concerns** | Design principle of keeping reliability, ordering, and flow control logically independent. |
| **Concurrent Logical Channels** | Parallel stop-and-wait channels used in ARPANET to maintain throughput. |
| **Pipe Full** | State where sender continuously sends enough data to fill the link’s capacity. |
| **Finite Sequence Numbers** | Limited number space requiring careful wraparound handling. |
