# üöÄ 4.4 Multiprotocol Label Switching (MPLS)

## Summary

### Overview

**MPLS (Multiprotocol Label Switching)** enhances IP networking by combining the **connectionless flexibility** of IP with the **efficiency and control** of virtual circuits.  
Instead of forwarding packets solely by destination IP, MPLS routers use short, fixed-length **labels** to determine the next hop‚Äîenabling faster, more flexible, and more deterministic forwarding.

Originally aimed at performance improvement, MPLS is now valued for three major capabilities:

1. Enabling IP services on devices that cannot natively forward IP packets  
2. Supporting **explicit routing** (steering traffic along specific paths)  
3. Providing **VPN services** via **label-based tunneling**

---

## üß© 4.4.1 Destination-Based Forwarding

### How MPLS Forwarding Works

- Routers assign labels to IP **prefixes** and advertise label‚Äìprefix bindings via the **Label Distribution Protocol (LDP)**.  
- When a packet enters the MPLS network:
  - A **Label Edge Router (LER)** attaches a label.  
  - Intermediate **Label Switching Routers (LSRs)** forward packets by **swapping labels**, without inspecting IP headers.  
  - This replaces longest-prefix matching with faster **exact-match lookups**.

### Key Concept: Forwarding Equivalence Class (FEC)

A **FEC** is a set of packets that share identical forwarding behavior.

- Example: all packets for prefix `18.1.1/24` belong to one FEC.  
- Each router assigns one label per FEC.

### Implementation Details

- Labels are added as a **shim header** between the Layer 2 and IP headers.  
- In ATM networks, MPLS reuses **VCI/VPI** fields.  
- MPLS lets **ATM or optical switches** act as **Label Switching Routers (LSRs)** via software upgrades, avoiding full IP lookups.

### Benefits

- Integrates IP routing control with hardware-optimized switching (e.g., ATM, WDM).  
- Simplifies complex overlays by merging them into a single routing domain.  
- Enables **Generalized MPLS (GMPLS)** for optical and time-division multiplexed systems, unifying control of non-IP transport layers.

---

## üß≠ 4.4.2 Explicit Routing

### Concept

MPLS supports **explicit routes** ‚Äî pre-defined paths packets must follow.  
Unlike end-host source routing, these routes are typically chosen by routers or network operators.

### Example: The ‚ÄúFish Network‚Äù

In a ‚Äúfish-shaped‚Äù topology:

- Traffic from **R1 ‚Üí R7** might take R1‚ÄìR3‚ÄìR6‚ÄìR7.  
- Traffic from **R2 ‚Üí R7** could follow R2‚ÄìR3‚ÄìR4‚ÄìR5‚ÄìR7.  
These paths are enforced with **labels** rather than traditional IP metrics.

### Mechanism

- **RSVP (Resource Reservation Protocol)** extensions set up **Label-Switched Paths (LSPs)** along explicit routes.  
- Each router installs label mappings, forming a virtual circuit‚Äìlike tunnel.

### Applications

1. **Traffic Engineering (TE)**  
   - Balances load and satisfies bandwidth constraints.  
   - Uses algorithms such as **Constrained Shortest Path First (CSPF)**.  

2. **Fast Reroute (FRR)**  
   - Precomputed backup LSPs allow **instant failover** on link failure‚Äîbefore routing protocols reconverge.

---

## üîí 4.4.3 Virtual Private Networks (VPNs) and Tunnels

### MPLS as a Tunneling Mechanism

MPLS encapsulates packets similar to IP tunnels but uses **labels instead of IP headers**, reducing overhead.

#### Layer 2 VPNs (Pseudowires)

- MPLS tunnels can carry Layer 2 frames (Ethernet, ATM, Frame Relay).  
- Known as **pseudowire emulation**, this lets legacy services run over IP backbones.  
- Each packet carries two labels:
  1. **Tunnel label** ‚Äì identifies the MPLS path.  
  2. **Demultiplexing label** ‚Äì identifies the specific emulated circuit.

‚Üí Enables transparent ATM or Ethernet delivery over MPLS.

#### Layer 3 VPNs

- Among the most common MPLS use cases today.  
- Service providers create **virtually private IP networks** for customers on a shared backbone.  
- Customers remain **isolated**, each using private IPs independently.  
- Implemented with **label stacking** and managed via **BGP**.  
- Allows selective Internet interconnection without exposing internal networks.

---

### MPLS in Summary

MPLS bridges the gap between **datagram** and **virtual-circuit** models by:

- Combining IP‚Äôs routing flexibility with circuit-like control.  
- Supporting both IP and non-IP payloads.  
- Enabling scalable VPNs, traffic engineering, and optical transport integration.

It remains one of the Internet‚Äôs most critical but invisible backbone technologies.

---

## üìò Glossary

| **Term** | **Definition** |
|-----------|----------------|
| **MPLS (Multiprotocol Label Switching)** | Network technology that forwards packets via short labels instead of IP lookups. |
| **Label** | Fixed-length identifier attached to packets to determine forwarding. |
| **Label Edge Router (LER)** | Router at the MPLS network edge that assigns and removes labels. |
| **Label Switching Router (LSR)** | Core MPLS router that swaps labels during forwarding. |
| **Forwarding Equivalence Class (FEC)** | Set of packets treated identically for forwarding. |
| **Label Distribution Protocol (LDP)** | Protocol used to advertise label‚Äìprefix bindings. |
| **Exact Match Lookup** | High-speed lookup using a fixed label index. |
| **Generalized MPLS (GMPLS)** | Extension of MPLS for optical and time-division transport networks. |
| **Explicit Routing** | Predetermined routing path through the network. |
| **Traffic Engineering (TE)** | Optimization technique balancing traffic loads and performance. |
| **RSVP (Resource Reservation Protocol)** | Protocol for reserving resources or establishing LSPs. |
| **Fast Reroute (FRR)** | MPLS feature providing rapid failover via backup paths. |
| **CSPF (Constrained Shortest Path First)** | Routing algorithm considering constraints like bandwidth. |
| **VPN (Virtual Private Network)** | Private logical network over shared infrastructure. |
| **Pseudowire Emulation** | MPLS tunneling that carries Layer 2 frames across IP networks. |
| **Layer 2 VPN** | VPN transporting Layer 2 frames (e.g., Ethernet, ATM). |
| **Layer 3 VPN** | VPN providing IP-level isolation using MPLS and BGP. |
| **Label Stack** | Multiple labels on one packet enabling tunneling layers. |
| **Tunnel Label** | MPLS label defining the path across a provider‚Äôs core. |
| **Demultiplexing Label** | Label identifying a specific service or pseudowire. |

---
