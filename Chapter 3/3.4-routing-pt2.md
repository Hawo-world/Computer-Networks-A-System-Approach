# ğŸŒ 3.4 Part 2 â€” Routing: Link-State, OSPF, and Metrics

*(Covers: 3.4.3 Link-State Routing, 3.4.4 Metrics)*

---

## 3.4.3 Link-State Routing (OSPF)

### ğŸ”¹ Core Idea

While **Distance Vector (DV)** routers share what they *believe* about the network with their *neighbors*,  
**Link-State (LS)** routers share what they *know for sure* (their own links) with *every other router*.

> DV: â€œI heard from others that X is this far.â€  
> LS: â€œHereâ€™s exactly who Iâ€™m connected to and how costly each link is.â€

---

### ğŸ”¹ Two Main Mechanisms

1. **Reliable Flooding** â€“ distributes link-state information to all routers.  
2. **Shortest Path Calculation** â€“ computes best routes using full network topology.

---

### ğŸ”¸ Reliable Flooding

Each router periodically generates a **Link-State Packet (LSP)** containing:

- Router ID  
- List of neighbors and link costs  
- Sequence number (tracks freshness)  
- Time to Live (TTL)

#### Flooding Process

1. Router creates an LSP and sends it to **all neighbors**.  
2. Neighbors store the latest version (by sequence number).  
3. They forward it to **other neighbors** (not back to sender).  
4. Flooding stops once every router has the newest copy.

- Newer info â†’ replace and reflood.  
- Duplicates or older info â†’ discard.  
- Link-layer ACKs ensure reliable propagation.

#### Maintenance

- **Periodic LSPs:** long intervals (e.g., hours).  
- **Triggered LSPs:** on link failure/change.  
- **Hello messages:** detect dead neighbors.  
- **Sequence numbers & TTLs:** prevent stale data.

ğŸ§© **Goal:** Quickly disseminate fresh topology data while minimizing routing overhead.

---

### ğŸ”¸ Route Calculation â€” *Dijkstraâ€™s Algorithm*

After collecting all LSPs, each router builds the full network graph and runs **Dijkstraâ€™s shortest path algorithm**.

**Input:** All routers and link costs.  
**Output:** Least-cost path from self to every router.

#### Simplified Procedure

1. Start with self (cost = 0).  
2. Add the lowest-cost neighbor.  
3. Update tentative distances via that neighbor.  
4. Repeat until all routers are processed.  
5. Result â†’ **shortest path tree**.

âœ… Each router computes its own **forwarding table** from this tree.

#### Example

- Router D computes routes to A, B, and C.  
- Even if it examines longer paths first, Dijkstraâ€™s guarantees optimal routes.  
- This process is a **forward search**.

---

### ğŸ”¸ Properties of Link-State Routing

| Feature | Description |
|----------|--------------|
| **Convergence** | Very fast â€” routers compute directly from full topology. |
| **Traffic Overhead** | Low â€” only changes are flooded. |
| **Storage Cost** | High â€” must store one LSP per router. |
| **Failure Detection** | Rapid via hello timers and triggered updates. |
| **Scalability** | Moderate â€” improved with hierarchy (e.g., OSPF areas). |

---

### ğŸ”¹ Comparison: Distance Vector vs Link State

| Feature | Distance Vector (RIP) | Link State (OSPF) |
|----------|----------------------|-------------------|
| **Info Exchanged** | Entire routing table | Local link states |
| **Recipients** | Direct neighbors | All routers |
| **Algorithm** | Bellman-Ford | Dijkstra (SPF) |
| **Convergence Speed** | Slow | Fast |
| **Loop Prevention** | Hard (count-to-infinity) | Easy (global map) |
| **Scalability** | Small/medium networks | Large domains |
| **Example Protocol** | RIP | OSPF |

---

## ğŸ§­ The Open Shortest Path First (OSPF) Protocol

### ğŸ”¹ Overview

- **OSPF** = standardized, open version of link-state routing (IETF).  
- â€œOpenâ€ = non-proprietary, â€œShortest Path Firstâ€ = Dijkstraâ€™s algorithm.  
- Used for **intradomain routing** on the Internet.

---

### ğŸ”¸ Key OSPF Features

1. **Authentication of Routing Messages**  
   - Prevents spoofed or malicious updates.  
   - Modern OSPF supports **cryptographic authentication**.  

2. **Hierarchical Areas**  
   - Divides routing domain into **areas** to scale.  
   - Routers know full details only within their area.  
   - Reduces flooding and computation.  

3. **Load Balancing**  
   - Supports **equal-cost multipath (ECMP)** routing.  
   - Distributes traffic evenly across equal-cost paths.

---

### ğŸ”¸ OSPF Message Format

| Field | Purpose |
|--------|----------|
| **Version** | OSPF version (v2). |
| **Type** | Message type (1â€“5). |
| **SourceAddr** | Senderâ€™s IP address. |
| **AreaID** | 32-bit identifier of the OSPF area. |
| **Checksum** | Detects header errors. |
| **Authentication Type & Data** | Optional password or cryptographic hash. |

---

### ğŸ”¸ OSPF Message Types

| Type | Function |
|------|-----------|
| **1** | Hello (neighbor discovery and keepalive) |
| **2â€“5** | Request, send, and acknowledge link-state advertisements (LSAs) |

---

### ğŸ”¸ Link-State Advertisement (LSA)

- Fundamental building block of OSPF routing information.  
- Each LSA includes:
  - Router ID  
  - List of neighbor links and costs  
  - Sequence number, checksum, and age  
  - Optional TOS-based metrics (rarely used)

ğŸ§© **Types:**
- **Type 1:** Router LSAs â€” advertise links between routers.  
- **Type 2:** Network LSAs â€” advertise shared networks.  
- Other types summarize or connect hierarchical areas.

---

### ğŸ”¸ Advantages of OSPF

- Fast, loop-free convergence.  
- Hierarchical scalability.  
- Authentication and security support.  
- Load balancing and flexible metrics.  
- Broad adoption in enterprise and ISP networks.

---

## 3.4.4 Metrics

### ğŸ”¹ What Are Metrics?

**Metrics** quantify the â€œcostâ€ or desirability of a path.  
They may depend on:

- Hop count  
- Bandwidth  
- Delay  
- Reliability or load  

Routing algorithms use metrics to compute **least-cost paths**.

---

### ğŸ”¹ ARPANET Case Study â€” Evolving Metrics

ARPANET pioneered link metric design, showing the balance between **stability** and **responsiveness**.

#### Version 1 â€” Queue Length

- Metric = packets waiting in queue.  
- âŒ Problem: Caused oscillation â€” routers chased â€œshortest queueâ€ routes.

#### Version 2 â€” Delay-Based Metric

- Metric = queueing delay + transmission time + latency.  
- âŒ Problems:
  - Overreacted to congestion (oscillations).  
  - Huge dynamic range (could prefer 126-hop paths).

#### Version 3 â€” Smoothed, Bounded Metric

- âœ… Added:
  - **Smoothing** (average utilization).  
  - **Hard limits** on per-cycle change.  
  - **Compressed range** (max 3Ã— under load).  
  - Considered **link type/speed**.  

â¡ï¸ **Result:** Stable, realistic, and simple â€” successful balance.

---

### ğŸ”¹ Modern Practice

Most networks now use **static metrics** set by administrators.

Common formula:  
\[
\text{Cost} = k \times \frac{1}{\text{link bandwidth}}
\]

---

### ğŸ”¹ Lessons Learned

ğŸ’¡ **Design Iteratively:** Start simple, refine with real-world feedback.  
ğŸ’¡ **KISS Principle:** Simple designs scale and fail less often.

---

## ğŸŒŸ Key Takeaways (Part 2)

1. **Link-State Routing:** Each router floods link info and computes shortest paths.  
2. **OSPF:** Dominant LS protocol â€” fast, secure, hierarchical, scalable.  
3. **Metrics:** Quantify path cost; ARPANETâ€™s history shows simplicity beats complexity.  
4. **Simplicity & Stability:** Core of effective routing design.  
5. **DV vs LS:**  
   - DV â†’ simple but slow and loop-prone.  
   - LS â†’ complex but fast, loop-free, scalable.

---

## ğŸ“˜ Glossary (Part 2)

| Term | Definition |
|------|-------------|
| **Link-State Routing (LS)** | Routers flood info about their links to all others. |
| **Link-State Packet (LSP)** | Message describing a routerâ€™s neighbors and link costs. |
| **Flooding** | Dissemination of LSPs throughout the network. |
| **Hello Packet** | Used to detect live neighbors in OSPF. |
| **Dijkstraâ€™s Algorithm** | Computes shortest paths from one router to all others. |
| **Forward Search Algorithm** | Dijkstra implementation for routing tables. |
| **OSPF (Open Shortest Path First)** | Standardized link-state protocol for IP networks. |
| **LSA (Link-State Advertisement)** | Core OSPF message describing router/network state. |
| **Area (in OSPF)** | Subdivision of a routing domain for scalability. |
| **Authentication (OSPF)** | Ensures routing messages come from trusted sources. |
| **Metric (Link Cost)** | Numeric value representing path desirability. |
| **Dynamic Metric** | Cost that changes with load or delay. |
| **Static Metric** | Fixed cost assigned manually. |
| **KISS Principle** | â€œKeep It Simple, Stupidâ€ â€” simplicity improves reliability. |
| **Convergence** | State when all routers share consistent routing info. |

---
