# 🌐 3.4 Part 2 — Routing: Link-State, OSPF, and Metrics

*(Covers: 3.4.3 Link-State Routing, 3.4.4 Metrics)*

---

## 3.4.3 Link-State Routing (OSPF)

### 🔹 Core Idea

While **Distance Vector (DV)** routers share what they *believe* about the network with their *neighbors*,  
**Link-State (LS)** routers share what they *know for sure* (their own links) with *every other router*.

> DV: “I heard from others that X is this far.”  
> LS: “Here’s exactly who I’m connected to and how costly each link is.”

---

### 🔹 Two Main Mechanisms

1. **Reliable Flooding** – distributes link-state information to all routers.  
2. **Shortest Path Calculation** – computes best routes using full network topology.

---

### 🔸 Reliable Flooding

Each router periodically generates a **Link-State Packet (LSP)** containing:

- Router ID  
- List of neighbors and link costs  
- Sequence number (tracks freshness)  
- Time to Live (TTL)

#### Flooding Process

1. Router creates an LSP and sends it to **all neighbors**.  
2. Neighbors store the latest version (by sequence number).  
3. They forward it to **other neighbors** (not back to sender).  
4. Flooding stops once every router has the newest copy.

- Newer info → replace and reflood.  
- Duplicates or older info → discard.  
- Link-layer ACKs ensure reliable propagation.

#### Maintenance

- **Periodic LSPs:** long intervals (e.g., hours).  
- **Triggered LSPs:** on link failure/change.  
- **Hello messages:** detect dead neighbors.  
- **Sequence numbers & TTLs:** prevent stale data.

🧩 **Goal:** Quickly disseminate fresh topology data while minimizing routing overhead.

---

### 🔸 Route Calculation — *Dijkstra’s Algorithm*

After collecting all LSPs, each router builds the full network graph and runs **Dijkstra’s shortest path algorithm**.

**Input:** All routers and link costs.  
**Output:** Least-cost path from self to every router.

#### Simplified Procedure

1. Start with self (cost = 0).  
2. Add the lowest-cost neighbor.  
3. Update tentative distances via that neighbor.  
4. Repeat until all routers are processed.  
5. Result → **shortest path tree**.

✅ Each router computes its own **forwarding table** from this tree.

#### Example

- Router D computes routes to A, B, and C.  
- Even if it examines longer paths first, Dijkstra’s guarantees optimal routes.  
- This process is a **forward search**.

---

### 🔸 Properties of Link-State Routing

| Feature | Description |
|----------|--------------|
| **Convergence** | Very fast — routers compute directly from full topology. |
| **Traffic Overhead** | Low — only changes are flooded. |
| **Storage Cost** | High — must store one LSP per router. |
| **Failure Detection** | Rapid via hello timers and triggered updates. |
| **Scalability** | Moderate — improved with hierarchy (e.g., OSPF areas). |

---

### 🔹 Comparison: Distance Vector vs Link State

| Feature | Distance Vector (RIP) | Link State (OSPF) |
|----------|----------------------|-------------------|
| **Info Exchanged** | Entire routing table | Local link states |
| **Recipients** | Direct neighbors | All routers |
| **Algorithm** | Bellman-Ford | Dijkstra (SPF) |
| **Convergence Speed** | Slow | Fast |
| **Loop Prevention** | Hard (count-to-infinity) | Easy (global map) |
| **Scalability** | Small/medium networks | Large domains |
| **Example Protocol** | RIP | OSPF |

---

## 🧭 The Open Shortest Path First (OSPF) Protocol

### 🔹 Overview

- **OSPF** = standardized, open version of link-state routing (IETF).  
- “Open” = non-proprietary, “Shortest Path First” = Dijkstra’s algorithm.  
- Used for **intradomain routing** on the Internet.

---

### 🔸 Key OSPF Features

1. **Authentication of Routing Messages**  
   - Prevents spoofed or malicious updates.  
   - Modern OSPF supports **cryptographic authentication**.  

2. **Hierarchical Areas**  
   - Divides routing domain into **areas** to scale.  
   - Routers know full details only within their area.  
   - Reduces flooding and computation.  

3. **Load Balancing**  
   - Supports **equal-cost multipath (ECMP)** routing.  
   - Distributes traffic evenly across equal-cost paths.

---

### 🔸 OSPF Message Format

| Field | Purpose |
|--------|----------|
| **Version** | OSPF version (v2). |
| **Type** | Message type (1–5). |
| **SourceAddr** | Sender’s IP address. |
| **AreaID** | 32-bit identifier of the OSPF area. |
| **Checksum** | Detects header errors. |
| **Authentication Type & Data** | Optional password or cryptographic hash. |

---

### 🔸 OSPF Message Types

| Type | Function |
|------|-----------|
| **1** | Hello (neighbor discovery and keepalive) |
| **2–5** | Request, send, and acknowledge link-state advertisements (LSAs) |

---

### 🔸 Link-State Advertisement (LSA)

- Fundamental building block of OSPF routing information.  
- Each LSA includes:
  - Router ID  
  - List of neighbor links and costs  
  - Sequence number, checksum, and age  
  - Optional TOS-based metrics (rarely used)

🧩 **Types:**
- **Type 1:** Router LSAs — advertise links between routers.  
- **Type 2:** Network LSAs — advertise shared networks.  
- Other types summarize or connect hierarchical areas.

---

### 🔸 Advantages of OSPF

- Fast, loop-free convergence.  
- Hierarchical scalability.  
- Authentication and security support.  
- Load balancing and flexible metrics.  
- Broad adoption in enterprise and ISP networks.

---

## 3.4.4 Metrics

### 🔹 What Are Metrics?

**Metrics** quantify the “cost” or desirability of a path.  
They may depend on:

- Hop count  
- Bandwidth  
- Delay  
- Reliability or load  

Routing algorithms use metrics to compute **least-cost paths**.

---

### 🔹 ARPANET Case Study — Evolving Metrics

ARPANET pioneered link metric design, showing the balance between **stability** and **responsiveness**.

#### Version 1 — Queue Length

- Metric = packets waiting in queue.  
- ❌ Problem: Caused oscillation — routers chased “shortest queue” routes.

#### Version 2 — Delay-Based Metric

- Metric = queueing delay + transmission time + latency.  
- ❌ Problems:
  - Overreacted to congestion (oscillations).  
  - Huge dynamic range (could prefer 126-hop paths).

#### Version 3 — Smoothed, Bounded Metric

- ✅ Added:
  - **Smoothing** (average utilization).  
  - **Hard limits** on per-cycle change.  
  - **Compressed range** (max 3× under load).  
  - Considered **link type/speed**.  

➡️ **Result:** Stable, realistic, and simple — successful balance.

---

### 🔹 Modern Practice

Most networks now use **static metrics** set by administrators.

Common formula:  
\[
\text{Cost} = k \times \frac{1}{\text{link bandwidth}}
\]

---

### 🔹 Lessons Learned

💡 **Design Iteratively:** Start simple, refine with real-world feedback.  
💡 **KISS Principle:** Simple designs scale and fail less often.

---

## 🌟 Key Takeaways (Part 2)

1. **Link-State Routing:** Each router floods link info and computes shortest paths.  
2. **OSPF:** Dominant LS protocol — fast, secure, hierarchical, scalable.  
3. **Metrics:** Quantify path cost; ARPANET’s history shows simplicity beats complexity.  
4. **Simplicity & Stability:** Core of effective routing design.  
5. **DV vs LS:**  
   - DV → simple but slow and loop-prone.  
   - LS → complex but fast, loop-free, scalable.

---

## 📘 Glossary (Part 2)

| Term | Definition |
|------|-------------|
| **Link-State Routing (LS)** | Routers flood info about their links to all others. |
| **Link-State Packet (LSP)** | Message describing a router’s neighbors and link costs. |
| **Flooding** | Dissemination of LSPs throughout the network. |
| **Hello Packet** | Used to detect live neighbors in OSPF. |
| **Dijkstra’s Algorithm** | Computes shortest paths from one router to all others. |
| **Forward Search Algorithm** | Dijkstra implementation for routing tables. |
| **OSPF (Open Shortest Path First)** | Standardized link-state protocol for IP networks. |
| **LSA (Link-State Advertisement)** | Core OSPF message describing router/network state. |
| **Area (in OSPF)** | Subdivision of a routing domain for scalability. |
| **Authentication (OSPF)** | Ensures routing messages come from trusted sources. |
| **Metric (Link Cost)** | Numeric value representing path desirability. |
| **Dynamic Metric** | Cost that changes with load or delay. |
| **Static Metric** | Fixed cost assigned manually. |
| **KISS Principle** | “Keep It Simple, Stupid” — simplicity improves reliability. |
| **Convergence** | State when all routers share consistent routing info. |

---
